<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>defparameter; defvar (ANSI Common Lisp)</title>

<meta name="description" content="defparameter; defvar (ANSI Common Lisp)">
<meta name="keywords" content="defparameter; defvar (ANSI Common Lisp)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="Table-of-Contents.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Data-and-Control-Flow.html" rel="up" title="Data and Control Flow">
<link href="destructuring_002dbind.html" rel="next" title="destructuring-bind">
<link href="defconstant.html" rel="prev" title="defconstant">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
body {font-family: century schoolbook, serif;
      line-height: 1.3;
      padding-left: 5em; padding-right: 1em;
      padding-bottom: 1em; max-width: 60em;}
table {border-collapse: collapse}
span.roman { font-family: century schoolbook, serif; font-weight: normal; }
h1, h2, h3, h4, h5, h6 {font-family:  Helvetica, sans-serif}
dfn {font-family: inherit; font-variant: italic; font-weight: bolder }
kbd {font-family: monospace; text-decoration: underline}
var {font-family: Helvetica, sans-serif; font-variant: slanted}
td  {padding-right: 1em; padding-left: 1em}
sub {font-size: smaller}
.node {padding: 0; margin: 0}

-->
</style>


</head>

<body lang="en">
<span id="defparameter_003b-defvar"></span><div class="header">
<p>
Next: <a href="destructuring_002dbind.html" accesskey="n" rel="next">destructuring-bind</a>, Previous: <a href="defconstant.html" accesskey="p" rel="prev">defconstant</a>, Up: <a href="Data-and-Control-Flow.html" accesskey="u" rel="up">Data and Control Flow</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="node-heading">defparameter; defvar</h4>
<span id="defparameter_002c-defvar-_0028Macro_0029"></span><h3 class="heading">defparameter, defvar (Macro)</h3>
<span id="index-defparameter-2"></span>
<span id="index-defparameter"></span>
<span id="index-defvar-2"></span>
<span id="index-defvar"></span>
<span id="defparameter"></span><span id="defvar"></span>

<span id="Syntax_003a-47"></span><h4 class="subsubheading">Syntax:</h4>

<dl>
<dt id="index-defparameter-1">Macro: <strong>defparameter</strong> <em>name         initial-value <tt>[</tt>documentation<tt>]</tt>  <span class="roman">→</span> name</em></dt>
</dl>
<dl>
<dt id="index-defvar-1">Macro: <strong>defvar</strong> <em>name <tt>[</tt>initial-value <tt>[</tt>documentation<tt>]</tt><tt>]</tt> <span class="roman">→</span> name</em></dt>
</dl>

<span id="Arguments-and-Values_003a-37"></span><h4 class="subsubheading">Arguments and Values:</h4>

<p><var>name</var>&mdash;a <i>symbol</i>; not evaluated.
</p>

<p><var>initial-value</var>&mdash;a <i>form</i>; 
for <code>defparameter</code>, it is always <i>evaluated</i>,
but for <code>defvar</code> it is <i>evaluated</i> 
only if <var>name</var> is not already <i>bound</i>.
</p>
<p><var>documentation</var>&mdash;a <var>string</var>; not evaluated.
</p>
<span id="Description_003a-69"></span><h4 class="subsubheading">Description:</h4>

<p><code>defparameter</code> and <code>defvar</code> <i>establish</i> <var>name</var> 
as a <i>dynamic variable</i>.
</p>
<p><code>defparameter</code> unconditionally
<i>assigns</i> the <var>initial-value</var> to the <i>dynamic variable</i> named <var>name</var>.
<code>defvar</code>, by contrast, <i>assigns</i> <var>initial-value</var> (if supplied) 
to the <i>dynamic variable</i> named <var>name</var> 
only if <var>name</var> is not already <i>bound</i>.
</p>
<p>If no <var>initial-value</var> is supplied,
<code>defvar</code> leaves the <i>value cell</i> of 
the <i>dynamic variable</i> named <var>name</var> undisturbed;
if <var>name</var> was previously <i>bound</i>, its old <i>value</i> persists,
and if it was previously <i>unbound</i>, it remains <i>unbound</i>.
</p>
<p>If <var>documentation</var> is supplied, it is attached to <var>name</var> as a
<i>documentation string</i> of kind <tt>variable</tt>. 
</p>
<p><code>defparameter</code> and <code>defvar</code> normally appear as a <i>top level form</i>, 
but it is meaningful for them to appear as <i>non-top-level forms</i>.  However,
the compile-time side effects described below only take place when
they appear as <i>top level forms</i>.
</p>
<span id="Examples_003a-43"></span><h4 class="subsubheading">Examples:</h4>

<div class="lisp">
<pre class="lisp"> (defparameter *p* 1) <span class="roman">→</span> *P*
 *p* <span class="roman">→</span> 1
 (constantp '*p*) <span class="roman">→</span> <i>false</i>
 (setq *p* 2) <span class="roman">→</span> 2
 (defparameter *p* 3) <span class="roman">→</span> *P*
 *p* <span class="roman">→</span> 3

 (defvar *v* 1) <span class="roman">→</span> *V*
 *v* <span class="roman">→</span> 1
 (constantp '*v*) <span class="roman">→</span> <i>false</i>
 (setq *v* 2) <span class="roman">→</span> 2
 (defvar *v* 3) <span class="roman">→</span> *V*
 *v* <span class="roman">→</span> 2

 (defun foo ()
   (let ((*p* 'p) (*v* 'v))
     (bar))) <span class="roman">→</span> FOO
 (defun bar () (list *p* *v*)) <span class="roman">→</span> BAR
 (foo) <span class="roman">→</span> (P V)
</pre></div>


<p>The principal operational distinction between <code>defparameter</code> and <code>defvar</code>
is that <code>defparameter</code> makes an unconditional assignment to <var>name</var>,
while <code>defvar</code> makes a conditional one.  In practice, this means that
<code>defparameter</code> is useful in situations where loading or reloading the definition
would want to pick up a new value of the variable, while <code>defvar</code> is used in
situations where the old value would want to be retained if the file were loaded or reloaded.
For example, one might create a file which contained:
</p>
<div class="lisp">
<pre class="lisp"> (defvar *the-interesting-numbers* '())
 (defmacro define-interesting-number (name n)
   `(progn (defvar ,name ,n)
           (pushnew ,name *the-interesting-numbers*)
           ',name))
 (define-interesting-number *my-height* 168) ;cm
 (define-interesting-number *my-weight* 13)  ;stones
</pre></div>


<p>Here the initial value, <code>()</code>, for the variable <code>*the-interesting-numbers*</code>
is just a seed that we are never likely to want to reset to something else
once something has been grown from it.  As such, we have used <code>defvar</code> 
to avoid having the <code>*interesting-numbers*</code> information reset if the file is
loaded a second time.  It is true that the two calls to
<code>define-interesting-number</code> here would be reprocessed, but
if there were additional calls in another file, they would not be and that 
information would be lost.  On the other hand, consider the following code:
</p>
<div class="lisp">
<pre class="lisp"> (defparameter *default-beep-count* 3)
 (defun beep (&amp;optional (n *default-beep-count*))
   (dotimes (i n) (si:%beep 1000. 100000.) (sleep 0.1)))
</pre></div>


<p>Here we could easily imagine editing the code to change the initial value of
<code>*default-beep-count*</code>, and then reloading the file to pick up the new value.
In order to make value updating easy, we have used <code>defparameter</code>.
</p>
<p>On the other hand, there is potential value to using <code>defvar</code> in this
situation.  For example, suppose that someone had predefined an alternate
value for <code>*default-beep-count*</code>, or had loaded the file and then manually
changed the value.  In both cases, if we had used <code>defvar</code> instead of
<code>defparameter</code>, those user preferences would not be overridden by
(re)loading the file.
</p>
<p>The choice of whether to use <code>defparameter</code> or <code>defvar</code> has
visible consequences to programs, but is nevertheless often made for subjective
reasons.
</p>
<span id="Side-Effects_003a"></span><h4 class="subsubheading">Side Effects:</h4>

<p>If a <code>defvar</code> or <code>defparameter</code> <i>form</i> appears as a <i>top level form</i>,
the <i>compiler</i> must recognize that the <var>name</var> has been
proclaimed <code>special</code>.  However, it must neither <i>evaluate</i> 
the <var>initial-value</var> <i>form</i> nor <i>assign</i> the 
<i>dynamic variable</i> named <var>name</var> at compile time.
</p>
<p>There may be additional (<i>implementation-defined</i>) compile-time or 
run-time side effects, as long as such effects do not interfere with the
correct operation of <i>conforming programs</i>.
</p>
<span id="Affected-By_003a-4"></span><h4 class="subsubheading">Affected By:</h4>

<p><code>defvar</code> is affected by whether <var>name</var> is already <i>bound</i>.
</p>
<span id="See-Also_003a-54"></span><h4 class="subsubheading">See Also:</h4>

<p><a href="declaim.html">declaim</a>, 
<a href="defconstant.html">defconstant</a>,
<a href="documentation_003b-setf-documentation.html#documentation">documentation</a>,
<a href="Compilation.html">Section 3.2 (Compilation)</a>
</p>
<span id="Notes_003a-34"></span><h4 class="subsubheading">Notes:</h4>

<p>It is customary to name <i>dynamic variables</i> with an <i>asterisk</i>
at the beginning and end of the name.  e.g., <code>*foo*</code> is a good name for
a <i>dynamic variable</i>, but not for a <i>lexical variable</i>;
<code>foo</code> is a good name for a <i>lexical variable</i>, 
but not for a <i>dynamic variable</i>.
This naming convention is observed for all <i>defined names</i> in <span class="roman">Common Lisp</span>;
however, neither <i>conforming programs</i> nor <i>conforming implementations</i>
are obliged to adhere to this convention.
</p>
<p>The intent of the permission for additional side effects is to allow
<i>implementations</i> to do normal &ldquo;bookkeeping&rdquo; that accompanies
definitions.  For example, the <i>macro expansion</i> of a <code>defvar</code>
or <code>defparameter</code> <i>form</i> might include code that arranges to
record the name of the source file in which the definition occurs.
</p>
<p><code>defparameter</code> and <code>defvar</code> might be defined as follows:
</p>
<div class="lisp">
<pre class="lisp"> (defmacro defparameter (name initial-value 
                         &amp;optional (documentation nil documentation-p))
   `(progn (declaim (special ,name))
           (setf (symbol-value ',name) ,initial-value)
           ,(when documentation-p
              `(setf (documentation ',name 'variable) ',documentation))
           ',name))
 (defmacro defvar (name &amp;optional
                        (initial-value nil initial-value-p)
                        (documentation nil documentation-p))
   `(progn (declaim (special ,name))
           ,(when initial-value-p
              `(unless (boundp ',name)
                 (setf (symbol-value ',name) ,initial-value)))
           ,(when documentation-p
              `(setf (documentation ',name 'variable) ',documentation))
           ',name))
</pre></div>



<hr>
<div class="header">
<p>
Next: <a href="destructuring_002dbind.html" accesskey="n" rel="next">destructuring-bind</a>, Previous: <a href="defconstant.html" accesskey="p" rel="prev">defconstant</a>, Up: <a href="Data-and-Control-Flow.html" accesskey="u" rel="up">Data and Control Flow</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
