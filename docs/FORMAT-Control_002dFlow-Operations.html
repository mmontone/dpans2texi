<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>FORMAT Control-Flow Operations (ANSI Common Lisp)</title>

<meta name="description" content="FORMAT Control-Flow Operations (ANSI Common Lisp)">
<meta name="keywords" content="FORMAT Control-Flow Operations (ANSI Common Lisp)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="Table-of-Contents.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Formatted-Output.html" rel="up" title="Formatted Output">
<link href="FORMAT-Miscellaneous-Operations.html" rel="next" title="FORMAT Miscellaneous Operations">
<link href="FORMAT-Layout-Control.html" rel="prev" title="FORMAT Layout Control">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
body {font-family: century schoolbook, serif;
      line-height: 1.3;
      padding-left: 5em; padding-right: 1em;
      padding-bottom: 1em; max-width: 60em;}
table {border-collapse: collapse}
span.roman { font-family: century schoolbook, serif; font-weight: normal; }
h1, h2, h3, h4, h5, h6 {font-family:  Helvetica, sans-serif}
dfn {font-family: inherit; font-variant: italic; font-weight: bolder }
kbd {font-family: monospace; text-decoration: underline}
var {font-family: Helvetica, sans-serif; font-variant: slanted}
td  {padding-right: 1em; padding-left: 1em}
sub {font-size: smaller}
.node {padding: 0; margin: 0}

-->
</style>


</head>

<body lang="en">
<span id="FORMAT-Control_002dFlow-Operations"></span><div class="header">
<p>
Next: <a href="FORMAT-Miscellaneous-Operations.html" accesskey="n" rel="next">FORMAT Miscellaneous Operations</a>, Previous: <a href="FORMAT-Layout-Control.html" accesskey="p" rel="prev">FORMAT Layout Control</a>, Up: <a href="Formatted-Output.html" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="FORMAT-Control_002dFlow-Operations-1"></span><h4 class="subsection">22.3.7 FORMAT Control-Flow Operations</h4>

<span id="Tilde-Asterisk_003a-Go_002dTo"></span><h4 class="subsubsection">22.3.7.1 Tilde Asterisk: Go-To</h4>
<span id="index-Asterisk-_0028format-directive_0029"></span>
<span id="index-Tilde-Asterisk-_0028format-directive_0029"></span>


<p>The next <i>arg</i> is ignored.
<code>~<i>n</i>*</code> ignores the next <i>n</i> arguments.
</p>
<p><code>~:*</code> backs up in the list of
arguments so that the argument last processed will be processed again.
<code>~<i>n</i>:*</code> backs up <i>n</i> arguments.
</p>
<p>When within a <code>~<tt>{</tt></code> construct
(see below), the ignoring (in either direction) is relative to the list
of arguments being processed by the iteration.
</p>
<p><code>~<i>n</i>@*</code> 
goes to the <i>n</i>th <i>arg</i>, where 0 means the first one;
<i>n</i> defaults to 0, so <code>~@*</code> goes back to the first <i>arg</i>.      
Directives after a <code>~<i>n</i>@*</code>
will take arguments in sequence beginning with the one gone to.
When within a <code>~<tt>{</tt></code> construct, the &ldquo;goto&rdquo;
is relative to the list of arguments being processed by the iteration.
</p>

<span id="Tilde-Left_002dBracket_003a-Conditional-Expression"></span><h4 class="subsubsection">22.3.7.2 Tilde Left-Bracket: Conditional Expression</h4>
<span id="index-Left_002dBracket-_0028format-directive_0029"></span>
<span id="index-Tilde-Left_002dBracket-_0028format-directive_0029"></span>

<p><code>~[<i>str0</i>~;<i>str1</i>~;<i>...</i>~;<i>strn</i>~]</code>
</p>
<p>This is a set of control strings, called <i>clauses</i>, one of which is
chosen and used.  The clauses are separated by <code>~;</code>
and the construct is terminated by <code>~]</code>.  For example,
</p>
<p><code>&quot;~[Siamese~;Manx~;Persian~] Cat&quot;</code>
</p>
<p>The <i>arg</i>th
clause is selected, where the first clause is number 0.
If a prefix parameter is given (as <code>~<i>n</i>[</code>),
then the parameter is used instead of an argument.    
If <i>arg</i> is out of range then no clause is selected
and no error is signaled.
After the selected alternative has been processed, the control string
continues after the <code>~]</code>.
</p>
<p><code>~[<i>str0</i>~;<i>str1</i>~;<i>...</i>~;<i>strn</i>~:;<i>default</i>~]</code>
has a default case.
If the <i>last</i> <code>~;</code> used to separate clauses
is <code>~:;</code> instead, then the last clause is an else clause
that is performed if no other clause is selected.
For example:
</p>
<p><code>&quot;~[Siamese~;Manx~;Persian~:;Alley~] Cat&quot;</code>
</p>
<p><code>~:[<var>alternative</var>~;<var>consequent</var>~]</code> 
selects the <var>alternative</var> control string if <i>arg</i> is <i>false</i>,
and selects the <var>consequent</var> control string otherwise.
</p>
<p><code>~@[<var>consequent</var>~]</code> 
tests the argument.  If it is <i>true</i>,           
then the argument is not used up by the <code>~[</code> command
but remains as the next one to be processed,
and the one clause <var>consequent</var> is processed.
If the <i>arg</i> is <i>false</i>, then the argument is used up,
and the clause is not processed.
The clause therefore should normally use exactly one argument,
and may expect it to be <i>non-nil</i>.
For example:
</p>
<div class="lisp">
<pre class="lisp"> (setq *print-level* nil *print-length* 5)
 (format nil
        &quot;~@[ print level = ~D~]~@[ print length = ~D~]&quot;
        *print-level* *print-length*)
<span class="roman">→</span>  &quot; print length = 5&quot;
</pre></div>


<p>Note also that
</p>
<div class="lisp">
<pre class="lisp"> (format <var>stream</var> &quot;...~@[<var>str</var>~]...&quot; ...)
≡ (format <var>stream</var> &quot;...~:[~;~:*<var>str</var>~]...&quot; ...)
</pre></div>


<p>The combination of <code>~[</code> and <code>#</code> is useful, for
example, for dealing with English conventions for printing lists:
</p>
<div class="lisp">
<pre class="lisp"> (setq foo &quot;Items:~#[ none~; ~S~; ~S and ~S~
           ~:;~@<tt>{</tt>~#[~; and~] ~S~^ <!-- /@w -->,~<tt>}</tt>~].&quot;)
 (format nil foo) <span class="roman">→</span>  &quot;Items: none.&quot;
 (format nil foo 'foo) <span class="roman">→</span>  &quot;Items: FOO.&quot;
 (format nil foo 'foo 'bar) <span class="roman">→</span>  &quot;Items: FOO and BAR.&quot;
 (format nil foo 'foo 'bar 'baz) <span class="roman">→</span>  &quot;Items: FOO, BAR, and BAZ.&quot;
 (format nil foo 'foo 'bar 'baz 'quux) <span class="roman">→</span>  &quot;Items: FOO, BAR, BAZ, and QUUX.&quot;
</pre></div>



<span id="Tilde-Right_002dBracket_003a-End-of-Conditional-Expression"></span><h4 class="subsubsection">22.3.7.3 Tilde Right-Bracket: End of Conditional Expression</h4>
<span id="index-Right_002dBracket-_0028format-directive_0029"></span>
<span id="index-Tilde-Right_002dBracket-_0028format-directive_0029"></span>

<p><code>~]</code> terminates a <code>~[</code>.
The consequences of using it elsewhere are undefined.
</p>

<span id="Tilde-Left_002dBrace_003a-Iteration"></span><h4 class="subsubsection">22.3.7.4 Tilde Left-Brace: Iteration</h4>
<span id="index-Left_002dBrace-_0028format-directive_0029"></span>
<span id="index-Tilde-Left_002dBrace-_0028format-directive_0029"></span>

<p><code>~<tt>{</tt><i>str</i>~<tt>}</tt></code>
</p>
<p>This is an iteration construct.  The argument should be a <i>list</i>,
which is used as a set of arguments 
as if for a recursive call to <code>format</code>.
The <i>string</i> <i>str</i> is used repeatedly as the control string.
Each iteration can absorb as many elements of the <i>list</i> as it likes
as arguments;
if <i>str</i> uses up two arguments by itself, then two elements of the
<i>list</i> will get used up each time around the loop.
If before any iteration step the <i>list</i> 
is empty, then the iteration is terminated.
Also, if a prefix parameter <i>n</i> is given, then there will be at most <i>n</i>
repetitions of processing of <i>str</i>.  
Finally, the <code>~^ </code> directive can be
used to terminate the iteration prematurely.
</p>
<p>For example:
</p>
<div class="lisp">
<pre class="lisp"> (format nil &quot;The winners are:~<tt>{</tt> ~S~<tt>}</tt>.&quot; 
         '(fred harry jill)) 
<span class="roman">→</span> &quot;The winners are: FRED HARRY JILL.&quot;                           
 (format nil &quot;Pairs:~<tt>{</tt> &lt;~S,~S&gt;~<tt>}</tt>.&quot; 
         '(a 1 b 2 c 3))
<span class="roman">→</span> &quot;Pairs: &lt;A,1&gt; &lt;B,2&gt; &lt;C,3&gt;.&quot;
</pre></div>


<p><code>~:{ <i>str</i>~}  </code> is similar, 
but the argument should be a <i>list</i> of sublists.
At each repetition step, one sublist 
is used as the set of arguments for
processing <i>str</i>; on the next repetition, a new sublist 
is used, whether
or not all of the last sublist had been processed.  
For example:
</p>


<div class="lisp">
<pre class="lisp"> (format nil &quot;Pairs:~:{ &lt;~S,~S&gt;~} <!-- /@w -->.&quot; 
                 '((a 1) (b 2) (c 3)))
<span class="roman">→</span> &quot;Pairs: &lt;A,1&gt; &lt;B,2&gt; &lt;C,3&gt;.&quot;
</pre></div>


<p><code>~@{ <i>str</i>~} </code>
is similar to <code>~{ <i>str</i>~}  </code>, but instead of
using one argument that is a list, all the remaining arguments
are used as the list of arguments for the iteration.
Example:
</p>
<div class="lisp">
<pre class="lisp"> (format nil &quot;Pairs:~@{ &lt;~S,~S&gt;~} <!-- /@w -->.&quot; 'a 1 'b 2 'c 3)
<span class="roman">→</span> &quot;Pairs: &lt;A,1&gt; &lt;B,2&gt; &lt;C,3&gt;.&quot;
</pre></div>

<p>If the iteration is terminated before all the remaining arguments are
consumed, then any arguments not processed by the iteration remain to be
processed by any directives following the iteration construct.
</p>
<p><code>~:@{ <i>str</i>~}  </code> 
combines the features                              
of <code>~:{ <i>str</i>~}  </code>
and <code>~@{ <i>str</i>~}  </code>.
All the remaining arguments
are used, and each one must be a <i>list</i>.
On each iteration, the next argument is 
used as a <i>list</i> of arguments to <i>str</i>.
Example:
</p>
<div class="lisp">
<pre class="lisp"> (format nil &quot;Pairs:~:@{ &lt;~S,~S&gt;~} <!-- /@w -->.&quot; 
              '(a 1) '(b 2) '(c 3)) 
<span class="roman">→</span> &quot;Pairs: &lt;A,1&gt; &lt;B,2&gt; &lt;C,3&gt;.&quot;
</pre></div>

<p>Terminating the repetition construct with <code>~:} </code> 
instead of <code>~}  </code>
forces <i>str</i> to be processed at least once, even if the initial
list of arguments is null. However, this will not override an explicit
prefix parameter of zero.
</p>
<p>If <i>str</i> is empty, then an argument is used as <i>str</i>.  
It must be a <i>format control</i>
and precede any arguments processed by the iteration.  As an example,
the following are equivalent:
</p>
<div class="lisp">
<pre class="lisp">    (apply #'format stream string arguments)
 ≡ (format stream &quot;~1<tt>{</tt>~:<tt>}</tt>&quot; string arguments)
</pre></div>


<p>This will use <code>string</code> as a formatting string.  
The <code>~1{ </code> says it will                 
be processed at most once, and the <code>~:} </code> 
says it will be processed at least once.
Therefore it is processed exactly once, using <code>arguments</code> as the arguments.
This case may be handled more clearly by the <code>~?</code> directive,
but this general feature of <code>~{  </code>
is more powerful than <code>~?</code>.
</p>

<span id="Tilde-Right_002dBrace_003a-End-of-Iteration"></span><h4 class="subsubsection">22.3.7.5 Tilde Right-Brace: End of Iteration</h4>
<span id="index-Right_002dBrace-_0028format-directive_0029"></span>
<span id="index-Tilde-Right_002dBrace-_0028format-directive_0029"></span>


<p><code>~<tt>}</tt></code> terminates a <code>~<tt>{</tt></code>.
The consequences of using it elsewhere are undefined.
</p>

<span id="Tilde-Question_002dMark_003a-Recursive-Processing"></span><h4 class="subsubsection">22.3.7.6 Tilde Question-Mark: Recursive Processing</h4>
<span id="index-Question_002dMark-_0028format-directive_0029"></span>
<span id="index-Tilde-Question_002dMark-_0028format-directive_0029"></span>

<p>The next <i>arg</i> must be a <i>format control</i>, and the one after it a <i>list</i>;
both are consumed by the <code>~?</code> directive.
The two are processed as a <var>control-string</var>, with the elements of the <i>list</i> 
as the arguments.  Once the recursive processing
has been finished, the processing of the control
string containing the <code>~?</code> directive is resumed.
Example:
</p>
<div class="lisp">
<pre class="lisp"> (format nil &quot;~? ~D&quot; &quot;&lt;~A ~D&gt;&quot; '(&quot;Foo&quot; 5) 7) <span class="roman">→</span> &quot;&lt;Foo 5&gt; 7&quot;
 (format nil &quot;~? ~D&quot; &quot;&lt;~A ~D&gt;&quot; '(&quot;Foo&quot; 5 14) 7) <span class="roman">→</span> &quot;&lt;Foo 5&gt; 7&quot;
</pre></div>

<p>Note that in the second example three arguments are supplied
to the <i>format string</i> <code>&quot;&lt;~A ~D&gt;&quot;</code>, but only two are processed
and the third is therefore ignored.
</p>
<p>With the <code>@</code>
modifier, only one <i>arg</i> is directly consumed.
The <i>arg</i> must be a <i>string</i>; 
it is processed as part of the control
string as if it had appeared in place of the <code>~@?</code> construct,
and any directives in the recursively processed control string may      
consume arguments of the control string containing the <code>~@?</code>
directive.
Example:
</p>
<div class="lisp">
<pre class="lisp"> (format nil &quot;~@? ~D&quot; &quot;&lt;~A ~D&gt;&quot; &quot;Foo&quot; 5 7) <span class="roman">→</span> &quot;&lt;Foo 5&gt; 7&quot;
 (format nil &quot;~@? ~D&quot; &quot;&lt;~A ~D&gt;&quot; &quot;Foo&quot; 5 14 7) <span class="roman">→</span> &quot;&lt;Foo 5&gt; 14&quot;
</pre></div>




<hr>
<div class="header">
<p>
Next: <a href="FORMAT-Miscellaneous-Operations.html" accesskey="n" rel="next">FORMAT Miscellaneous Operations</a>, Previous: <a href="FORMAT-Layout-Control.html" accesskey="p" rel="prev">FORMAT Layout Control</a>, Up: <a href="Formatted-Output.html" accesskey="u" rel="up">Formatted Output</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
