<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Determining the Class Precedence List (ANSI Common Lisp)</title>

<meta name="description" content="Determining the Class Precedence List (ANSI Common Lisp)">
<meta name="keywords" content="Determining the Class Precedence List (ANSI Common Lisp)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="Table-of-Contents.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Classes.html" rel="up" title="Classes">
<link href="Redefining-Classes.html" rel="next" title="Redefining Classes">
<link href="Inheritance.html" rel="prev" title="Inheritance">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
body {font-family: century schoolbook, serif;
      line-height: 1.3;
      padding-left: 5em; padding-right: 1em;
      padding-bottom: 1em; max-width: 60em;}
table {border-collapse: collapse}
span.roman { font-family: century schoolbook, serif; font-weight: normal; }
h1, h2, h3, h4, h5, h6 {font-family:  Helvetica, sans-serif}
dfn {font-family: inherit; font-variant: italic; font-weight: bolder }
kbd {font-family: monospace; text-decoration: underline}
var {font-family: Helvetica, sans-serif; font-variant: slanted}
td  {padding-right: 1em; padding-left: 1em}
sub {font-size: smaller}
.node {padding: 0; margin: 0}

-->
</style>


</head>

<body lang="en">
<span id="Determining-the-Class-Precedence-List"></span><div class="header">
<p>
Next: <a href="Redefining-Classes.html" accesskey="n" rel="next">Redefining Classes</a>, Previous: <a href="Inheritance.html" accesskey="p" rel="prev">Inheritance</a>, Up: <a href="Classes.html" accesskey="u" rel="up">Classes</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Determining-the-Class-Precedence-List-1"></span><h4 class="subsection">4.3.5 Determining the Class Precedence List</h4>

<p>The <code>defclass</code> form for a <i>class</i> provides a total ordering
on that <i>class</i> and its direct <i>superclasses</i>.  This ordering is
called the <span id="index-local-precedence-order-1"></span>
<em>local precedence order</em>.  It is an ordered list of the
<i>class</i> and its direct <i>superclasses</i>. The
<span id="index-class-precedence-list-1"></span>
<em>class precedence list</em> for a class C is a total ordering on
C and its <i>superclasses</i> that is consistent with the
<i>local precedence orders</i> for each of C and its <i>superclasses</i>.
</p>
<p>A <i>class</i> precedes its direct <i>superclasses</i>, 
and a direct <i>superclass</i> precedes all other 
direct <i>superclasses</i> specified to its right 
in the <i>superclasses</i> list of the <code>defclass</code> form.  
For every class C, define 
</p><blockquote>
<p>R<sub>C</sub>
</p></blockquote>
<p>where C<sub>1</sub>
the direct <i>superclasses</i> of C in the order in which
they are mentioned in the <code>defclass</code> form. These ordered pairs
generate the total ordering on the class C and its direct
<i>superclasses</i>.
</p>
<p>Let S<sub>C</sub>
</p>
<blockquote>
<p>R=⋃<sub>c∈ S<sub>C</sub>
</p></blockquote>
<p>.
</p>


<p>The set R might or might not generate a partial ordering, depending on
whether the R<sub>c</sub>
consistent; it is assumed
that they are consistent and that R generates a partial ordering.
When the R<sub>c</sub>
</p>
<p>To compute the <i>class precedence list</i> for&nbsp;C,
topologically sort the elements of S<sub>C</sub>
partial ordering generated by R.  When the topological
sort must select a <i>class</i> from a set of two or more 
<i>classes</i>, none of
which are preceded by other <i>classes</i> with respect to&nbsp;R,
the <i>class</i> selected is chosen deterministically, as described below.
</p>
<p>If R is inconsistent, an error is signaled.
</p>


<span id="Topological-Sorting"></span><h4 class="subsubsection">4.3.5.1 Topological Sorting</h4>

<p>Topological sorting proceeds by finding a class C in&nbsp;S<sub>C</sub>
that no other <i>class</i> precedes that element according to the elements
in&nbsp;R.  The class C is placed first in the result.
Remove C from S<sub>C</sub>
D∈ S<sub>C</sub>
<i>classes</i> with no predecessors to the end of the result.  Stop when no
element can be found that has no predecessor.
</p>
<p>If S<sub>C</sub>
inconsistent. If every <i>class</i> in the finite set of 
<i>classes</i> is preceded
by another, then R contains a loop. That is, there is a chain of
classes C<sub>1</sub>
C<sub>i+1</sub>
</p>
<p>Sometimes there are several <i>classes</i> from S<sub>C</sub>
predecessors.  In this case select the one that has a direct
<i>subclass</i> rightmost in the <i>class precedence list</i> computed so far.
(If there is no such candidate <i>class</i>, R does not generate 
a partial ordering&mdash;the R<sub>c</sub>
</p>
<p>In more precise terms, let <tt>{</tt>N<sub>1</sub>
the <i>classes</i> from S<sub>C</sub>
constructed so far.  C<sub>1</sub>
such that there exists an i where 1≤ i≤ m and N<sub>i</sub>
is a direct <i>superclass</i> of C<sub>j</sub>
</p>
<p>The effect of this rule for selecting from a set of <i>classes</i> with no
predecessors is that the <i>classes</i> in a simple <i>superclass</i> chain are
adjacent in the <i>class precedence list</i> and that <i>classes</i> in each
relatively separated subgraph are adjacent in the <i>class precedence list</i>.
For example, let T<sub>1</sub>
element in common is the class J.
Suppose that no superclass of J appears in either T<sub>1</sub>
and that J is in the superclass chain of every class in both T<sub>1</sub>
Let C<sub>1</sub>
and let C<sub>2</sub>
Suppose C is a <i>class</i> whose direct <i>superclasses</i>
are C<sub>1</sub>
for C starts with C and is followed by
all <i>classes</i> in T<sub>1</sub>
All the <i>classes</i> of T<sub>2</sub>
The <i>class</i> J and its <i>superclasses</i> appear last.
</p>

<span id="Examples-of-Class-Precedence-List-Determination"></span><h4 class="subsubsection">4.3.5.2 Examples of Class Precedence List Determination</h4>

<p>This example determines a <i>class precedence list</i> for the
class <code>pie</code>.  The following <i>classes</i> are defined:
</p>
<div class="lisp">
<pre class="lisp"> (defclass pie (apple cinnamon) ())
 
 (defclass apple (fruit) ())
 
 (defclass cinnamon (spice) ())
 
 (defclass fruit (food) ())

 (defclass spice (food) ())

 (defclass food () ())
</pre></div>


<p>The set S<sub>pie</sub>
standard-object, t<tt>}</tt>. The set R&nbsp;= <tt>{</tt><code>(pie, apple),
(apple, cinnamon), (apple, fruit), (cinnamon, spice), 
(fruit, food), (spice, food), (food, standard-object), (standard-object,
t)</code><tt>}</tt>.
</p>
<p>The class <code>pie</code> is not preceded by anything, so it comes first;
the result so far is <code>(pie)</code>.  Remove <code>pie</code> from S and pairs
mentioning <code>pie</code> from R to get S&nbsp;= <tt>{</tt><code>apple, cinnamon,
fruit, spice, food, standard-object, t</code><tt>}</tt> and R&nbsp;=&nbsp;<tt>{</tt><code>(apple, cinnamon), (apple, fruit), (cinnamon, spice), (fruit,
food), (spice, food), (food, standard-object),
(standard-object, t)</code><tt>}</tt>.
</p>
<p>The class <code>apple</code> is not preceded by anything, so it is next; the
result is <code>(pie apple)</code>. Removing <code>apple</code> and the relevant
pairs results in S&nbsp;= <tt>{</tt><code>cinnamon, fruit, spice, food,
standard-object, t</code><tt>}</tt> and R&nbsp;= <tt>{</tt><code>(cinnamon, spice),
(fruit, food), (spice, food), (food, standard-object),
(standard-object, t)</code><tt>}</tt>.
</p>
<p>The classes <code>cinnamon</code> and <code>fruit</code> are not preceded by
anything, so the one with a direct <i>subclass</i> rightmost in the 
<i>class precedence list</i> computed so far goes next.  The class <code>apple</code> is a
direct <i>subclass</i> of <code>fruit</code>, and the class <code>pie</code> is a direct
<i>subclass</i> of <code>cinnamon</code>.  Because <code>apple</code> appears to the right
of <code>pie</code> in the <i>class precedence list</i>, 
<code>fruit</code> goes next, and the
result so far is <code>(pie apple fruit)</code>.  S&nbsp;= <tt>{</tt><code>cinnamon,
spice, food, standard-object, t</code><tt>}</tt>; R&nbsp;= <tt>{</tt><code>(cinnamon,
spice), (spice, food), (food, standard-object),
(standard-object, t)</code><tt>}</tt>.
</p>
<p>The class <code>cinnamon</code> is next, giving the result so far as <code>(pie apple fruit cinnamon)</code>.  At this point S&nbsp;= <tt>{</tt><code>spice,
food, standard-object, t</code><tt>}</tt>; R&nbsp;= <tt>{</tt><code>(spice, food), (food,
standard-object), (standard-object, t)</code><tt>}</tt>.
</p>
<p>The classes <code>spice</code>, <code>food</code>, <code>standard-object</code>, and 
<code>t</code> are added in that order, and the <i>class precedence list</i> 
is <code>(pie apple fruit cinnamon spice food standard-object t)</code>.
</p>
<p>It is possible to write a set of <i>class</i> definitions that cannot be 
ordered.   For example: 
</p>
<div class="lisp">
<pre class="lisp"> (defclass new-class (fruit apple) ())
 
 (defclass apple (fruit) ())
</pre></div>


<p>The class <code>fruit</code> must precede <code>apple</code> 
because the local ordering of <i>superclasses</i> must be preserved.
The class <code>apple</code> must precede <code>fruit</code> 
because a <i>class</i> always precedes its own <i>superclasses</i>.
When this situation occurs, an error is signaled, as happens here
when the system tries to compute the <i>class precedence list</i> 
of <code>new-class</code>.
</p>
<p>The following might appear to be a conflicting set of definitions:
</p>
<div class="lisp">
<pre class="lisp"> (defclass pie (apple cinnamon) ())
 
 (defclass pastry (cinnamon apple) ())
 
 (defclass apple () ())
 
 (defclass cinnamon () ())
</pre></div>


<p>The <i>class precedence list</i> for <code>pie</code> is 
<code>(pie apple cinnamon standard-object t)</code>.
</p>
<p>The <i>class precedence list</i> for <code>pastry</code> is  
<code>(pastry cinnamon apple standard-object t)</code>.
</p>
<p>It is not a problem for <code>apple</code> to precede <code>cinnamon</code> in the
ordering of the <i>superclasses</i> of <code>pie</code> but not in the ordering for
<code>pastry</code>.  However, it is not possible to build a new <i>class</i> that
has both <code>pie</code> and <code>pastry</code> as <i>superclasses</i>.
</p>

<hr>
<div class="header">
<p>
Next: <a href="Redefining-Classes.html" accesskey="n" rel="next">Redefining Classes</a>, Previous: <a href="Inheritance.html" accesskey="p" rel="prev">Inheritance</a>, Up: <a href="Classes.html" accesskey="u" rel="up">Classes</a> &nbsp; [<a href="Table-of-Contents.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
